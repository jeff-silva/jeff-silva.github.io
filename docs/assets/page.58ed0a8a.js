import{E as N,m as A,t as b,v as V,z as l,A as s,V as U,F as _,G as E,B as y,y as v,H as m,x as r,I as D,J as g,K as w,L as T,M as F,N as x,O as C,P as q,Q as z,R as M,S as L,T as j,U as H,W as O,X as G,Y as k,Z as I,$ as J,a0 as K,_ as Q}from"./entry.1ce149c4.js";import{u as W}from"./vue.f36acd1f.8327ac7d.js";import{_ as R}from"./lodash.fb661e38.js";import{i as X}from"./index.esm.db934170.js";import{g as Y,c as P,a as Z,d as S,s as ee,b as te,q as ae,e as le}from"./index.esm2017.ebd02658.js";import{_ as se}from"./nuxt-layout.bdcb008c.js";const B=o=>R.merge({collection:"",model:{id:!1,name:""},options:{singular:"",plural:"",datatable:{headers:[{title:"Title",key:"name"}]}}},o),oe={page:B({collection:"page",model:{id:!1,name:"",slug:"",compoments:[]},options:{singular:"Page",plural:"Pages",datatable:{headers:[{title:"Title",key:"name"},{title:"Slug",key:"slug"}]}}}),test:B({collection:"test",model:{id:!1,name:"",level:"user",permissions:[]},options:{singular:"Test",plural:"Tests",datatable:{headers:[{title:"Name",key:"name"},{title:"Level",key:"level"},{title:"Permissions",key:"permissions"}]},levels:[{value:"user",title:"User"},{value:"admin",title:"Admin"}],permissions:[{value:"posts:create",title:"Create Posts"},{value:"posts:update",title:"Update Posts"},{value:"posts:delete",title:"Delete Posts"}]}})},ne=(o={})=>{o={collection:"",data:{},model:{id:!1,name:""},options:{},events:[],...o},o.data={...o.model};const h=A(),p=Y(X(h.public.firebase)),t=a=>({code:a.code||"",message:a.message||"",fields:[]}),e=N({busy:!1,data:o.data,error:!1,async create(){try{if(e.data.id||!1)return;const c=P(p,o.collection),n=await Z(c,e.data);return e.data.id=n.id,e.eventDispatch("created"),e.eventDispatch("saved"),n}catch(a){e.error=t(a)}},async update(){try{const a=e.data.id||!1;if(!a)return;const c=S(p,o.collection,a),n=await ee(c,e.data);return e.eventDispatch("updated"),e.eventDispatch("saved"),n}catch(a){e.error=t(a)}},async save(){return e.data.id?e.update():e.create()},async delete(a={}){const c=a.id||!1;if(!c)return;const n=await te(S(p,o.collection,c));return e.eventDispatch("deleted"),n},async setData(a){e.data={...o.model,...a}},async resetData(){e.data={...o.model}},async eventDispatch(a){e.events.forEach(([c,n])=>{c==a&&n()})},events:o.events,options:o.options,search:{busy:!1,params:{orderBy:"id",limit:25},data:[],pagination:{},async submit(){let a=[];const c=P(p,o.collection),n=ae(c);(await le(n)).forEach(d=>{a.push({...o.model,...d.data(),id:d.id})}),e.search.data=a}}});return e},de=r("div",{style:{width:"5px"}},null,-1),ie=r("th",{style:{width:"50px"}},null,-1),re=r("th",null,"Name",-1),ue=r("th",{style:{width:"50px"}},null,-1),ce=r("td",null,null,-1),me={class:"d-flex pe-2",style:{gap:"10px"}},pe={__name:"crud",props:{model:{type:String,default:""},tableRowActions:{type:Object,default:()=>({})}},setup(o){const h=o,p=(u={})=>({...u}),t=ne(oe[h.model]||{});W({title:t.options.plural}),t.events.push(["saved",()=>{t.resetData(),t.search.submit(),n.hide()}]),t.events.push(["deleted",()=>{t.resetData(),t.search.submit()}]),t.search.submit();const e={VBtn:{size:35,flat:!0}},a=R.merge({delete:{title:"Delete",icon:"mdi-delete",color:"error",onClick:(u,d)=>{}},edit:{title:"Edit",icon:"mdi-pencil",color:"primary",onClick(u,d){t.setData({...d.item}),n.show()}}},h.tableRowActions),c=(u,d)=>{if(typeof u=="object"){for(let i in u){const f=u[i];typeof f=="function"&&(u[i]=$=>f($,d))}return u}},n=N({visible:!1,show(){n.visible=!0},hide(){n.visible=!1}});return(u,d)=>(b(),V("div",null,[l(L,x({items:m(t).search.data},m(t).options.datatable),{top:s(()=>[l(U,{flat:""},{append:s(()=>[l(_,{icon:"mdi-plus",onClick:d[0]||(d[0]=i=>n.show())}),de]),default:s(()=>[l(E,null,{default:s(()=>[y(v(m(t).options.plural),1)]),_:1})]),_:1})]),headers:s(i=>[r("tr",null,[ie,D(u.$slots,"table-header",g(w(p(i))),()=>[re]),ue])]),item:s(i=>[r("tr",null,[ce,D(u.$slots,"table-row",g(w(p(i))),()=>[r("td",null,v(i.item.name),1)]),r("td",null,[l(T,{defaults:e},{default:s(()=>[l(F,{location:"start"},{activator:s(f=>[l(_,x({icon:"mdi-dots-horizontal"},f.props),null,16)]),default:s(()=>[l(T,{defaults:e},{default:s(()=>[r("div",me,[(b(!0),V(C,null,q(m(a),f=>(b(),V(C,null,[f?(b(),z(_,g(x({key:0},c(f,i))),null,16)):M("",!0)],64))),256))])]),_:2},1024)]),_:2},1024)]),_:2},1024)])])]),_:3},16,["items"]),l(K,{modelValue:n.visible,"onUpdate:modelValue":d[4]||(d[4]=i=>n.visible=i),location:"end",width:"600",absolute:"",temporary:""},{default:s(()=>[l(j,{onSubmit:d[3]||(d[3]=H(i=>m(t).save(),["prevent"]))},{default:s(()=>[l(O,null,{default:s(()=>[y(v(m(t).data.id?"Edit":"Create")+" "+v(m(t).options.singular),1)]),_:1}),l(G,null,{default:s(()=>[D(u.$slots,"form",g(w(p({model:m(t)}))),()=>[l(k,{label:"Name",modelValue:m(t).data.name,"onUpdate:modelValue":d[1]||(d[1]=i=>m(t).data.name=i)},null,8,["modelValue"])]),r("pre",null,v(m(t).error),1)]),_:3}),l(I,null,{default:s(()=>[l(_,{onClick:d[2]||(d[2]=i=>{m(t).resetData(),n.hide()})},{default:s(()=>[y("Close")]),_:1}),l(J),l(_,{type:"submit"},{default:s(()=>[y("Save")]),_:1})]),_:1})]),_:3})]),_:3},8,["modelValue"])]))}},fe={},ve=r("th",null,"Nome",-1),he={class:"text-disabled"};function _e(o,h){const p=pe,t=se;return b(),V("div",null,[l(t,{name:"admin"},{main:s(()=>[l(p,{model:"page",tableRowActions:{test:{title:"Edit",icon:"mdi-home"}}},{"table-header":s(e=>[ve]),"table-row":s(e=>[r("td",null,[r("div",null,v(e.item.name),1),r("small",he,v(e.item.slug),1)])]),form:s(e=>[l(k,{label:"Title",modelValue:e.model.data.name,"onUpdate:modelValue":a=>e.model.data.name=a},null,8,["modelValue","onUpdate:modelValue"]),l(k,{label:"Slug",modelValue:e.model.data.slug,"onUpdate:modelValue":a=>e.model.data.slug=a},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})])}const xe=Q(fe,[["render",_e]]);export{xe as default};
